# Generated by Django 5.0.7 on 2025-12-19 12:18

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('employees', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='NSSAContribution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('year', models.PositiveIntegerField(unique=True)),
                ('employee_rate', models.DecimalField(decimal_places=2, default=Decimal('3.00'), help_text='Employee contribution percentage', max_digits=5)),
                ('employer_rate', models.DecimalField(decimal_places=2, default=Decimal('3.00'), help_text='Employer contribution percentage', max_digits=5)),
                ('minimum_wage', models.DecimalField(decimal_places=2, help_text='Minimum pensionable wage', max_digits=10)),
                ('maximum_wage', models.DecimalField(decimal_places=2, help_text='Maximum pensionable wage', max_digits=10)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'NSSA Contribution',
                'verbose_name_plural': 'NSSA Contributions',
                'ordering': ['-year'],
            },
        ),
        migrations.CreateModel(
            name='SalaryComponent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('code', models.CharField(blank=True, max_length=20, unique=True)),
                ('type', models.CharField(choices=[('EARNING', 'Earning'), ('DEDUCTION', 'Deduction'), ('ALLOWANCE', 'Allowance'), ('BONUS', 'Bonus'), ('REIMBURSEMENT', 'Reimbursement')], max_length=15)),
                ('description', models.TextField(blank=True, null=True)),
                ('is_taxable', models.BooleanField(default=True)),
                ('is_statutory', models.BooleanField(default=False, help_text='Statutory deductions (PAYE, NSSA, AIDS Levy)')),
                ('is_fixed', models.BooleanField(default=True, help_text='Fixed amount vs percentage of basic salary')),
                ('is_percentage', models.BooleanField(default=False)),
                ('percentage_of_basic', models.DecimalField(decimal_places=2, default=0, help_text='Percentage of basic salary', max_digits=5)),
                ('is_pro_rated', models.BooleanField(default=False, help_text='Pro-rate based on days worked')),
                ('display_order', models.PositiveIntegerField(default=0)),
                ('show_on_payslip', models.BooleanField(default=True)),
                ('is_nssa', models.BooleanField(default=False, help_text='NSSA contribution')),
                ('is_paye', models.BooleanField(default=False, help_text='Pay As You Earn (Income Tax)')),
                ('is_aids_levy', models.BooleanField(default=False, help_text='AIDS Levy (3% of PAYE)')),
                ('is_pension', models.BooleanField(default=False)),
                ('is_medical_aid', models.BooleanField(default=False)),
                ('is_housing_allowance', models.BooleanField(default=False)),
                ('is_transport_allowance', models.BooleanField(default=False)),
                ('is_meal_allowance', models.BooleanField(default=False)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Salary Component',
                'verbose_name_plural': 'Salary Components',
                'ordering': ['type', 'display_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='PayrollBatch',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('batch_number', models.CharField(blank=True, max_length=50, unique=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('pay_period_start', models.DateField()),
                ('pay_period_end', models.DateField()),
                ('payment_date', models.DateField()),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PROCESSING', 'Processing'), ('COMPLETED', 'Completed'), ('FAILED', 'Failed'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=15)),
                ('employment_types', models.JSONField(blank=True, default=list, help_text='List of employment types to include')),
                ('total_employees', models.PositiveIntegerField(default=0)),
                ('processed_employees', models.PositiveIntegerField(default=0)),
                ('failed_employees', models.PositiveIntegerField(default=0)),
                ('total_gross', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('total_deductions', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('total_net', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_payroll_batches', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_payroll_batches', to=settings.AUTH_USER_MODEL)),
                ('departments', models.ManyToManyField(blank=True, to='employees.department')),
            ],
            options={
                'verbose_name': 'Payroll Batch',
                'verbose_name_plural': 'Payroll Batches',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Payslip',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('payslip_number', models.CharField(blank=True, max_length=50, unique=True)),
                ('pay_period_start', models.DateField()),
                ('pay_period_end', models.DateField()),
                ('payment_date', models.DateField()),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING', 'Pending Approval'), ('APPROVED', 'Approved'), ('PROCESSED', 'Processed'), ('PAID', 'Paid'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=15)),
                ('basic_salary', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_working_days', models.PositiveIntegerField(default=0)),
                ('days_worked', models.PositiveIntegerField(default=0)),
                ('days_absent', models.PositiveIntegerField(default=0)),
                ('leave_days', models.PositiveIntegerField(default=0)),
                ('regular_hours', models.DecimalField(decimal_places=2, default=0, max_digits=6)),
                ('overtime_hours', models.DecimalField(decimal_places=2, default=0, max_digits=6)),
                ('gross_earnings', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_allowances', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_deductions', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('paye', models.DecimalField(decimal_places=2, default=0, help_text='Pay As You Earn (Income Tax)', max_digits=12)),
                ('nssa_employee', models.DecimalField(decimal_places=2, default=0, help_text='NSSA Employee Contribution', max_digits=12)),
                ('nssa_employer', models.DecimalField(decimal_places=2, default=0, help_text='NSSA Employer Contribution', max_digits=12)),
                ('aids_levy', models.DecimalField(decimal_places=2, default=0, help_text='AIDS Levy (3% of PAYE)', max_digits=12)),
                ('pension', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('medical_aid', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('loans', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('net_pay', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('currency', models.CharField(choices=[('USD', 'US Dollar'), ('ZWL', 'Zimbabwe Dollar')], default='USD', max_length=3)),
                ('exchange_rate', models.DecimalField(decimal_places=4, default=1, help_text='Exchange rate if paid in ZWL', max_digits=10)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('payment_method', models.CharField(choices=[('BANK_TRANSFER', 'Bank Transfer'), ('CASH', 'Cash'), ('CHEQUE', 'Cheque'), ('MOBILE_MONEY', 'Mobile Money')], default='BANK_TRANSFER', max_length=20)),
                ('payment_reference', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('internal_notes', models.TextField(blank=True, help_text='Internal notes (not shown to employee)')),
                ('is_final', models.BooleanField(default=False)),
                ('is_13th_cheque', models.BooleanField(default=False)),
                ('is_bonus_payment', models.BooleanField(default=False)),
                ('generated_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_payslips', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payslips', to='employees.employee')),
                ('prepared_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='prepared_payslips', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Payslip',
                'verbose_name_plural': 'Payslips',
                'ordering': ['-pay_period_start', 'employee'],
            },
        ),
        migrations.CreateModel(
            name='PayslipEntry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('calculation_basis', models.CharField(blank=True, max_length=200)),
                ('quantity', models.DecimalField(decimal_places=2, default=1, help_text='For components like overtime hours', max_digits=10)),
                ('rate', models.DecimalField(blank=True, decimal_places=2, help_text='Rate per unit for calculated components', max_digits=12, null=True)),
                ('notes', models.TextField(blank=True)),
                ('payslip', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='entries', to='payroll.payslip')),
                ('component', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='payroll.salarycomponent')),
            ],
            options={
                'verbose_name': 'Payslip Entry',
                'verbose_name_plural': 'Payslip Entries',
                'ordering': ['component__type', 'component__display_order'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeSalary',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('effective_from', models.DateField()),
                ('effective_to', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='salary_components', to='employees.employee')),
                ('component', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='payroll.salarycomponent')),
            ],
            options={
                'verbose_name': 'Employee Salary',
                'verbose_name_plural': 'Employee Salaries',
                'ordering': ['employee', 'component'],
            },
        ),
        migrations.CreateModel(
            name='TaxBracket',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('year', models.PositiveIntegerField()),
                ('min_income', models.DecimalField(decimal_places=2, max_digits=12)),
                ('max_income', models.DecimalField(blank=True, decimal_places=2, help_text='Null means no upper limit', max_digits=12, null=True)),
                ('rate', models.DecimalField(decimal_places=2, help_text='Tax rate percentage', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('fixed_amount', models.DecimalField(decimal_places=2, default=0, help_text='Fixed tax amount for this bracket', max_digits=12)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Tax Bracket',
                'verbose_name_plural': 'Tax Brackets',
                'ordering': ['year', 'min_income'],
                'unique_together': {('year', 'min_income')},
            },
        ),
        migrations.AddIndex(
            model_name='payslip',
            index=models.Index(fields=['employee', 'pay_period_start'], name='payroll_pay_employe_86289c_idx'),
        ),
        migrations.AddIndex(
            model_name='payslip',
            index=models.Index(fields=['status', 'payment_date'], name='payroll_pay_status_2ae635_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='payslip',
            unique_together={('employee', 'pay_period_start', 'pay_period_end')},
        ),
        migrations.AlterUniqueTogether(
            name='employeesalary',
            unique_together={('employee', 'component', 'effective_from')},
        ),
    ]
